{"version":3,"sources":["../../app-src/controllers/NegociacaoController.js"],"names":["Negociacoes","NegociacaoService","Negociacao","NegociacoesView","MensagemView","Mensagem","DataInvalidaException","DateConverter","getNegociacaoDao","Bind","NegociacaoController","constructor","$","document","querySelector","bind","_inputData","_inputQuantidade","_inputValor","_negociacoes","_mensagem","_service","_init","then","dao","listarTodos","negociacoes","forEach","negociacao","adiciona","catch","err","texto","event","preventDefault","_criaNegociacao","_limpaFormulario","console","log","stack","message","value","focus","paraData","parseInt","parseFloat","apaga","apagaTodos","esvazia","importaNegociacoes","obtemNegociacoesDoPeriodo","filter","novaNegociacao","paraArray","some","negociacaoExistente","equals"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["import { Negociacoes, NegociacaoService, Negociacao } from \"../domain/index.js\";\nimport { NegociacoesView, MensagemView, Mensagem, DataInvalidaException, DateConverter } from \"../ui/index.js\";\nimport { getNegociacaoDao, Bind } from \"../util/index.js\";\n\nexport class NegociacaoController {\n\tconstructor() {\n\t\tconst $ = document.querySelector.bind(document);\n\t\tthis._inputData = $(\"#data\");\n\t\tthis._inputQuantidade = $(\"#quantidade\");\n\t\tthis._inputValor = $(\"#valor\");\n\t\tthis._negociacoes = new Bind(\n\t\t\tnew Negociacoes(),\n\t\t\tnew NegociacoesView(\"#negociacoes\"),\n\t\t\t\"adiciona\", \"esvazia\"\n\t\t);\n\t\tthis._mensagem = new Bind(\n\t\t\tnew Mensagem(),\n\t\t\tnew MensagemView(\"#mensagemView\"),\n\t\t\t\"texto\"\n\t\t);\n\t\tthis._service = new NegociacaoService();\n\t\tthis._init();\n\t}\n\n\t_init() {\n\t\tgetNegociacaoDao()\n\t\t\t.then(dao => dao.listarTodos())\n\t\t\t.then(negociacoes => negociacoes.forEach(negociacao => this._negociacoes.adiciona(negociacao)))\n\t\t\t.catch(err => this._mensagem.texto = err);\n\t}\n\n\tadiciona(event) {\n\t\ttry {\n\t\t\tevent.preventDefault();\n\t\t\tconst negociacao = this._criaNegociacao();\n\n\t\t\tgetNegociacaoDao()\n\t\t\t\t.then(dao => dao.adiciona(negociacao))\n\t\t\t\t.then(() => {\n\t\t\t\t\tthis._negociacoes.adiciona(this._criaNegociacao());\n\t\t\t\t\tthis._mensagem.texto = \"Negociação adicionada com sucesso\";\n\t\t\t\t\tthis._limpaFormulario();\n\t\t\t\t})\n\t\t\t\t.catch(err => this._mensagem.texto = err);\n\t\t} catch (err) {\n\t\t\tconsole.log(err);\n\t\t\tconsole.log(err.stack);\n\n\t\t\tif(err instanceof DataInvalidaException) {\n\t\t\t\tthis._mensagem.texto = err.message;\n\t\t\t} else {\n\t\t\t\tthis._mensagem.texto = \"Um erro não esperado aconteceu. Entre em contato com o suporte\";\n\t\t\t}\n\t\t}\n\t}\n\n\t_limpaFormulario() {\n\t\tthis._inputData.value = \"\";\n\t\tthis._inputQuantidade.value = 1;\n\t\tthis._inputValor.value = 0.0;\n\t\tthis._inputData.focus();\n\t}\n\n\t_criaNegociacao() {\n\t\treturn new Negociacao(\n\t\t\tDateConverter.paraData(this._inputData.value),\n\t\t\tparseInt(this._inputQuantidade.value),\n\t\t\tparseFloat(this._inputValor.value)\n\t\t);\n\t}\n\n\tapaga() {\n\t\tgetNegociacaoDao()\n\t\t\t.then(dao => dao.apagaTodos())\n\t\t\tthen(() => {\n\t\t\t\tthis._negociacoes.esvazia();\n\t\t\t\tthis._mensagem.texto = \"Negociações apagadas com sucesso\";\n\t\t\t});\n\t}\n\n\timportaNegociacoes() {\n\t\tthis._service\n\t\t\t.obtemNegociacoesDoPeriodo()\n\t\t\t.then(negociacoes => {\n\t\t\t\tnegociacoes\n\t\t\t\t\t.filter(novaNegociacao => !this._negociacoes.paraArray().some(negociacaoExistente => novaNegociacao.equals(negociacaoExistente)))\n\t\t\t\t\t.forEach(negociacao => this._negociacoes.adiciona(negociacao));\n\t\t\t\tthis._mensagem.texto = \"Negociações do período importadas com sucesso\";\n\t\t\t})\n\t\t\t.catch(err => this._mensagem.texto = err);\n\t}\n}"]}