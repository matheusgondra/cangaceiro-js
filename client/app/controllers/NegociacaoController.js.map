{"version":3,"sources":["../../app-src/controllers/NegociacaoController.js"],"names":["Negociacoes","NegociacaoService","Negociacao","NegociacoesView","MensagemView","Mensagem","DateConverter","getNegociacaoDao","Bind","getExceptionMessage","debounce","controller","bindEvent","NegociacaoController","constructor","_inputData","_inputQuantidade","_inputValor","Object","assign","_negociacoes","_mensagem","_service","_init","dao","negociacoes","listarTodos","forEach","adiciona","negociacao","err","texto","event","_criaNegociacao","_limpaFormulario","value","focus","paraData","parseInt","parseFloat","apaga","apagaTodos","esvazia","importaNegociacoes","obtemNegociacoesDoPeriodo","console","log","filter","paraArray","some","novaNegociacao","equals","negociacaoExistente"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["import { Negociacoes, NegociacaoService, Negociacao } from \"../domain/index.js\";\nimport { NegociacoesView, MensagemView, Mensagem, DateConverter } from \"../ui/index.js\";\nimport { getNegociacaoDao, Bind, getExceptionMessage, debounce, controller, bindEvent } from \"../util/index.js\";\n\n@controller(\"#data\", \"#quantidade\", \"#valor\")\nexport class NegociacaoController {\n\tconstructor(_inputData, _inputQuantidade, _inputValor) {\n\t\tObject.assign(this, { _inputData, _inputQuantidade, _inputValor });\n\t\tthis._negociacoes = new Bind(\n\t\t\tnew Negociacoes(),\n\t\t\tnew NegociacoesView(\"#negociacoes\"),\n\t\t\t\"adiciona\", \"esvazia\"\n\t\t);\n\t\tthis._mensagem = new Bind(\n\t\t\tnew Mensagem(),\n\t\t\tnew MensagemView(\"#mensagemView\"),\n\t\t\t\"texto\"\n\t\t);\n\t\tthis._service = new NegociacaoService();\n\t\tthis._init();\n\t}\n\n\tasync _init() {\n\t\ttry {\n\t\t\tconst dao = await getNegociacaoDao();\n\t\t\tconst negociacoes = await dao.listarTodos()\n\t\t\tnegociacoes.forEach(negociacao => this._negociacoes.adiciona(negociacao));\n\t\t} catch (err) {\n\t\t\tthis._mensagem.texto = getExceptionMessage(err);\n\t\t}\n\t}\n\n\t@bindEvent(\"submit\", \".form\")\n\t@debounce()\n\tasync adiciona(event) {\n\t\ttry {\n\t\t\tconst negociacao = this._criaNegociacao();\n\t\t\tconst dao = await getNegociacaoDao();\n\t\t\tawait dao.adiciona(negociacao);\n\t\t\tthis._negociacoes.adiciona(negociacao);\n\t\t\tthis._mensagem.texto = \"Negociação adicionada com sucesso\";\n\t\t\tthis._limpaFormulario();\n\t\t} catch (err) {\n\t\t\tthis._mensagem.texto = getExceptionMessage(err);\n\t\t}\n\t}\n\n\t_limpaFormulario() {\n\t\tthis._inputData.value = \"\";\n\t\tthis._inputQuantidade.value = 1;\n\t\tthis._inputValor.value = 0.0;\n\t\tthis._inputData.focus();\n\t}\n\n\t_criaNegociacao() {\n\t\treturn new Negociacao(\n\t\t\tDateConverter.paraData(this._inputData.value),\n\t\t\tparseInt(this._inputQuantidade.value),\n\t\t\tparseFloat(this._inputValor.value)\n\t\t);\n\t}\n\n\t@bindEvent(\"click\", \"#botao-apaga\")\n\tasync apaga() {\n\t\ttry {\n\t\t\tconst dao = await getNegociacaoDao();\n\t\t\tawait dao.apagaTodos();\n\t\t\tthis._negociacoes.esvazia();\n\t\t\tthis._mensagem.texto = \"Negociações apagadas com sucesso\";\n\t\t} catch (err) {\n\t\t\tthis._mensagem.texto = getExceptionMessage(err);\n\t\t}\n\t}\n\n\t@bindEvent(\"click\", \"#botao-importa\")\n\t@debounce()\n\tasync importaNegociacoes() {\n\t\ttry {\n\t\t\tconst negociacoes = await this._service.obtemNegociacoesDoPeriodo();\n\t\t\tconsole.log(negociacoes);\n\t\t\tnegociacoes\n\t\t\t\t.filter(novaNegociacao => !this._negociacoes.paraArray().some(negociacaoExistente => novaNegociacao.equals(negociacaoExistente)))\n\t\t\t\t.forEach(negociacao => this._negociacoes.adiciona(negociacao));\n\t\t\tthis._mensagem.texto = \"Negociações do período importadas com sucesso\";\n\t\t} catch (err) {\n\t\t\tconsole.log(err)\n\t\t\tthis._mensagem.texto = getExceptionMessage(err);\n\t\t}\n\t}\n}"]}