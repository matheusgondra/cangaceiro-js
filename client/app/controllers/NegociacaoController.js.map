{"version":3,"sources":["../../app-src/controllers/NegociacaoController.js"],"names":["Negociacoes","NegociacaoService","Negociacao","NegociacoesView","MensagemView","Mensagem","DateConverter","getNegociacaoDao","Bind","getExceptionMessage","NegociacaoController","constructor","$","document","querySelector","bind","_inputData","_inputQuantidade","_inputValor","_negociacoes","_mensagem","_service","_init","dao","negociacoes","listarTodos","forEach","adiciona","negociacao","err","texto","event","preventDefault","_criaNegociacao","_limpaFormulario","value","focus","paraData","parseInt","parseFloat","apaga","apagaTodos","esvazia","importaNegociacoes","obtemNegociacoesDoPeriodo","filter","paraArray","some","novaNegociacao","equals","negociacaoExistente"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["import { Negociacoes, NegociacaoService, Negociacao } from \"../domain/index.js\";\nimport { NegociacoesView, MensagemView, Mensagem, DateConverter } from \"../ui/index.js\";\nimport { getNegociacaoDao, Bind, getExceptionMessage } from \"../util/index.js\";\n\nexport class NegociacaoController {\n\tconstructor() {\n\t\tconst $ = document.querySelector.bind(document);\n\t\tthis._inputData = $(\"#data\");\n\t\tthis._inputQuantidade = $(\"#quantidade\");\n\t\tthis._inputValor = $(\"#valor\");\n\t\tthis._negociacoes = new Bind(\n\t\t\tnew Negociacoes(),\n\t\t\tnew NegociacoesView(\"#negociacoes\"),\n\t\t\t\"adiciona\", \"esvazia\"\n\t\t);\n\t\tthis._mensagem = new Bind(\n\t\t\tnew Mensagem(),\n\t\t\tnew MensagemView(\"#mensagemView\"),\n\t\t\t\"texto\"\n\t\t);\n\t\tthis._service = new NegociacaoService();\n\t\tthis._init();\n\t}\n\n\tasync _init() {\n\t\ttry {\n\t\t\tconst dao = await getNegociacaoDao();\n\t\t\tconst negociacoes = await dao.listarTodos()\n\t\t\tnegociacoes.forEach(negociacao => this._negociacoes.adiciona(negociacao));\n\t\t} catch (err) {\n\t\t\tthis._mensagem.texto = getExceptionMessage(err);\n\t\t}\n\t}\n\n\tasync adiciona(event) {\n\t\ttry {\n\t\t\tevent.preventDefault();\n\t\t\tconst negociacao = this._criaNegociacao();\n\t\t\t\n\t\t\tconst dao = await getNegociacaoDao();\n\t\t\tawait dao.adiciona(negociacao);\n\t\t\tthis._negociacoes.adiciona(negociacao);\n\t\t\tthis._mensagem.texto = \"Negociação adicionada com sucesso\";\n\t\t\tthis._limpaFormulario();\n\t\t} catch (err) {\n\t\t\tthis._mensagem.texto = getExceptionMessage(err);\n\t\t}\n\t}\n\n\t_limpaFormulario() {\n\t\tthis._inputData.value = \"\";\n\t\tthis._inputQuantidade.value = 1;\n\t\tthis._inputValor.value = 0.0;\n\t\tthis._inputData.focus();\n\t}\n\n\t_criaNegociacao() {\n\t\treturn new Negociacao(\n\t\t\tDateConverter.paraData(this._inputData.value),\n\t\t\tparseInt(this._inputQuantidade.value),\n\t\t\tparseFloat(this._inputValor.value)\n\t\t);\n\t}\n\n\tasync apaga() {\n\t\ttry {\n\t\t\tconst dao = await getNegociacaoDao();\n\t\t\tawait dao.apagaTodos();\n\t\t\tthis._negociacoes.esvazia();\n\t\t\tthis._mensagem.texto = \"Negociações apagadas com sucesso\";\n\t\t} catch (err) {\n\t\t\tthis._mensagem.texto = getExceptionMessage(err);\n\t\t}\n\t}\n\n\tasync importaNegociacoes() {\n\t\ttry {\n\t\t\tconst negociacoes = await this._service.obtemNegociacoesDoPeriodo();\n\t\t\tnegociacoes\n\t\t\t\t.filter(novaNegociacao => !this._negociacoes.paraArray().some(negociacaoExistente => novaNegociacao.equals(negociacaoExistente)))\n\t\t\t\t.forEach(negociacao => this._negociacoes.adiciona(negociacao));\n\t\t\tthis._mensagem.texto = \"Negociações do período importadas com sucesso\";\n\t\t} catch (err) {\n\t\t\tthis._mensagem.texto = getExceptionMessage(err);\n\t\t}\n\t}\n}"]}